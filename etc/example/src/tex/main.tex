%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                           mklatex/main.tex                                   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Load `mklatex` interface and configuration in the first place.
% (Eventually pass options to `\documentclass`).
\newcommand{\texEtcPath}{\directlua{tex.write(os.getenv("LATEX_ETC_DIR"))}}
\RequirePackage{\texEtcPath/mklatex}

\documentclass[paper=a4,fontsize=11pt]{article}

% NOTE: Load Natbib it here instead of inside `mklatex.sty`
% Because if using a `\RequirePackage`, it throws an `Undefined control sequence` error for an unknown reason
\ifthenelse{\equal{\mklatexBibliographyPackage}{natbib}}{
  \usepackage{natbib}
}{}

\begin{document}

\title{MKLaTeX Example}
\author{Pierre Ayoub}

\maketitle

Example file of MkLaTeX.

\subfile{\texSrcPath/sec1.tex}
\subfile{\texSrcPath/sec2.tex}

\ifthenelse{\equal{\mklatexBibliographyPackage}{natbib}}{
  \bibliographystyle{plain}
  \bibliography{references.bib}
}{
  \printbibliography{}
}

\end{document}
